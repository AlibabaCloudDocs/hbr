# 使用OSS清单创建大数据量OSS备份计划

在大数据量的OSS备份场景中，使用HBR的OSS清单功能进行备份，可显著提升增量备份的性能。本文介绍使用OSS清单功能场景OSS备份计划的操作方法。

-   已创建标准或低频访问存储类型的存储空间（Bucket）。具体操作，请参见[创建存储空间](/cn.zh-CN/控制台用户指南/存储空间管理/创建存储空间.md)。
-   已创建备份OSS清单文件。如果您还未创建备份OSS的清单文件，请先创建OSS清单文件。具体操作，请参见[设置存储空间清单](/cn.zh-CN/控制台用户指南/存储空间管理/基础设置/设置存储空间清单.md)。

    **说明：**

    -   清单文件必须是启用状态的当前版本，并且其Bucket前缀必须与创建计划中参数备份Bucket Prefix的取值保持一致。
    -   清单文件当中字段必须包括Object大小、存储类型、最后更新日期和ETag。
    -   华南1（深圳）、华北3（张家口）和新加坡地域的服务入口已经支持OSS清单备份功能，其他地域会陆续开放。

## 背景信息

OSS的清单功能用于记录存储空间（Bucket）中指定文件（Object）的数量、大小、存储类型、加密状态等信息。在大数据量的OSS备份场景中，使用HBR的OSS清单功能进行备份，可显著提升增量备份的性能。推荐1亿以上的对象使用OSS清单功能进行备份，OSS清单产生时间由OSS决定，清单文件产生之前备份将会失败。

## 注意事项

使用HBR的OSS清单功能备份OSS数据时，有如下注意事项：

-   目前HBR不支持备份和恢复归档存储类型的Bucket、软链接（symlink）以及Object读写权限（ACL）。
-   低频存储类型的Bucket会产生较高的访问费用。
-   备份OSS将产生OSS请求费用，该费用由OSS收取。更多信息，请参见[计量计费概述](/cn.zh-CN/计量计费/计量项和计费项/计量计费概述.md)。
-   通过备份历史删除早期的备份版本时，不会影响其他备份版本数据的完整性。
-   OSS清单文件在OSS控制台进行维护。如何创建OSS清单，请参见[设置存储空间清单](/cn.zh-CN/控制台用户指南/存储空间管理/基础设置/设置存储空间清单.md)。
-   为提升增量备份性能，HBR使用最近7天内最新的清单文件进行备份。如果清单文件与上次备份清单相同则当前备份任务会失败，直到产生新的清单文件备份才能成功。

## 操作步骤

您可以按如下步骤创建备份计划。

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。。

2.  在左侧导航栏，选择**备份** \> **OSS备份**。

3.  在顶部菜单栏，选择OSS所在的地域。

4.  在备份计划页签，单击**备份Bucket**。

5.  在创建备份计划面板，按照以下说明填写各项参数，然后单击**确定**。

    **说明：** 使用OSS清单功能创建OSS备份计划，无法享受免费备份计划。

    ![OSS清单备份](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/9165275261/p292112.png)

    1.  按以下说明填写基础设置中涉及的各项参数。

        |参数|说明|
        |--|--|
        |备份OSS Bucket|从下拉框中选择待备份的OSS Bucket名称。|
        |备份计划名称|为该备份计划命名。可不填，默认名字随机分配。|
        |备份起始时间|选择备份开始执行的时间。时间精确到秒。|
        |到期付费续用|免费备份计划到期后，是否执行到期付费续用。        -   否（默认值）：免费备份计划到期后，不进行续费。您的备份计划将被删除。
        -   是：免费备份计划到期后，自动续费。 |

    2.  单击**显示高级设置**，并单击**立即转为付费使用**，启用高级设置，并按以下说明填写各项参数。

        |参数|说明|
        |--|--|
        |备份Bucket Prefix|指定备份某个Bucket的前缀，默认不指定前缀，即表示备份整个Bucket根目录。|
        |备份执行间隔|选择增量备份的频率。默认值为1天。时间单位：分钟、小时、天、周。|
        |备份保留策略|配置备份保留时间。        -   **指定保留时间**（默认值）：保留指定时长，时长通过**备份保留时间**确定。
        -   **永久**：永久保存备份数据。 |
        |备份保留时间|选择保留该备份的时间。默认值为1周。时间单位：天、周、月、年。|
        |备份库配置|配置备份保存的备份库。        -   **新建备份库**（默认值）：新建备份库的名称命名。可不填，默认名字随机分配。
        -   **选择备份库**：从备份库名称下拉框中选择已有备份库。 |
        |备份库名称|指定备份库的名称。|
        |是否使用OSS清单|是否使用OSS清单功能备份OSS文件。该场景配置为**使用**。        -   **不使用**：不使用OSS清单功能，即使用遍历Object方式备份。
        -   **使用**：使用OSS清单功能，提升OSS增量备份性能。 |
        |清单名称|从**清单名称**列表中，选择已创建的OSS清单。如何创建OSS清单，请参见[设置存储空间清单](/cn.zh-CN/控制台用户指南/存储空间管理/基础设置/设置存储空间清单.md)。|
        |备份后是否删除清单文件|备份计划完成后是否删除清单文件。该操作会对Bucket的清单文件进行删除。建议将清单文件放到独立Bucket或选择不删除进行手动管理。        -   **不删除**：不删除清单文件。如果有其他应用程序访问该OSS清单文件，建议配置该选项。
        -   **删除当前**：删除本次备份任务中使用的清单文件。
        -   **删除所有**：备份完成之后删除所有这次备份之前生成的清单文件。如果没有其他应用程序访问该OSS清单文件，建议配置该选项。 |

    备份计划创建完成后，HBR将按照指定的备份起始时间、备份执行间隔进行OSS备份任务。


## 相关操作

备份计划创建完成后，将按照指定的备份起始时间、备份执行间隔进行OSS备份任务。您还可以在备份计划页签的**操作**列进行如下相关操作。

|操作|说明|
|--|--|
|**立即执行**|立即开始执行备份任务。|
|**编辑**|已创建的OSS备份任务不满足预期，您可以修改OSS备份任务。|
|**备份历史**|您可以查看该文件系统最近3个月或者所有的备份历史。|
|**暂停计划**|暂停执行中的备份任务。|
|**继续计划**|将处于暂停状态的备份任务再次启动。|
|**删除计划**|删除执行中的备份任务。备份计划删除后，该备份计划不会继续执行，但仍保留已备份的数据。|
|**报警设置**|在备份失败或客户端与服务器连接断开时，HBR默认通过报警设置的方式发送报警。更多信息，请参见[备份报警](/cn.zh-CN/本地服务器备份教程/文件备份（新版）/备份报警.md)。|

[创建OSS恢复任务]()

