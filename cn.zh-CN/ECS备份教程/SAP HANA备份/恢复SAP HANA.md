# 恢复SAP HANA

使用混合云备份服务将SAP HANA数据库备份到云上备份仓库后，您可以根据需要将备份的数据库恢复到当前SAP HANA实例，将备份的数据库恢复到同仓库下其他SAP HANA实例，还可以将当前地域备份的数据库恢复至其他地域的SAP HANA实例。

## 前提条件

已完成SAP HANA备份，详情请参见[备份SAP HANA](/cn.zh-CN/ECS备份教程/SAP HANA备份/备份SAP HANA.md)。

## 背景信息

恢复SAP HANA数据库期间，混合云备份会自动为您停止数据库。因此，在恢复期间数据库无法访问。

## 同地域下的同实例恢复

将备份的数据库恢复到相同地域下的当前SAP HANA实例的操作步骤如下：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。

2.  在左侧导航栏，选择**备份** \> **ECS应用备份** \> **SAP HANA**。

3.  单击**SAP HANA实例**页签。

4.  找到需要恢复的SAP HANA实例，在其右侧的操作列表中，单击**恢复**。

5.  在新建恢复计划页签，选择与待恢复的同一个SAP HANA实例作为源实例进行恢复，单击**下一步**。

    ![HANA instance](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1559029951/p96449.jpg)

6.  确认源SAP HANA实例及目的SAP HANA实例信息无误后，选中要恢复目的实例的数据库，单击**下一步**。

    ![DB](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1559029951/p96454.jpg)

7.  根据需要选择不同的**恢复方式**并完成相关配置项，然后单击**下一步**。

    ![](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1559029951/p35979.png)

    各个配置项说明如下：

    |恢复方式|说明|配置项|
    |:---|:-|:--|
    |**最近时间**|将数据库恢复到已备份的最近可用状态|    -   **使用差异备份**：如果您需要使用差异备份或增量备份执行恢复，请选择此选项。如果选择在不使用差异备份或增量备份的情况下执行恢复，则使用日志备份进行恢复。
    -   **初始化日志区域**：如果不想恢复日志区域中的日志条目， 请选择此选项。恢复后，日志条目将从日志区域中删除。
    -   **检查差异和日志备份可用性**：开启此项后，在恢复开始时，系统会检查所需的差异备份和日志备份是否都可用。 如果缺少差异备份或日志备份，在更改数据之前会停止恢复。 |
    |**指定时间**|将数据库恢复到特定时间点|    -   **使用差异备份**：如果您需要使用差异备份或增量备份执行恢复，请选择此选项。如果选择在不使用差异备份或增量备份的情况下执行恢复，则使用日志备份进行恢复。
    -   **初始化日志区域**：如果不想恢复日志区域中的日志条目， 请选择此选项。恢复后，日志条目将从日志区域中删除。
    -   **检查差异和日志备份可用性**：开启此项后，在恢复开始时，系统会检查所需的差异备份和日志备份是否都可用。 如果缺少差异备份或日志备份，在更改数据之前会停止恢复。
    -   **恢复到这个时间**：选择需要恢复到的时间点。系统会将数据库恢复到离这个时间最近的状态。 |
    |**指定备份**|将数据库恢复到指定的数据库备份|**是否使用Catalog**：是否从Catalog中查找备份。 **说明：** 如果不使用Catalog，需要指定一个备份前缀，混合云备份服务会根据备份前缀进行恢复。 |
    |**日志位置**|将数据库还原到指定日志位置|    -   **使用差异备份**：如果您需要使用差异备份或增量备份执行恢复，请选择此选项。如果选择在不使用差异备份或增量备份的情况下执行恢复，则使用日志备份进行恢复。
    -   **初始化日志区域**：如果不想恢复日志区域中的日志条目， 请选择此选项。恢复后，日志条目将从日志区域中删除。
    -   **检查差异和日志备份可用性**：开启此项后，在恢复开始时，系统会检查所需的差异备份和日志备份是否都可用。 如果缺少差异备份或日志备份，在更改数据之前会停止恢复。
    -   **日志位置**：要恢复到的日志位置。
    -   **Volume ID**：要恢复的Volume。 |

8.  选择用来恢复的任意备份版本，单击**创建**。


## 同地域下的跨实例恢复

将备份的数据库恢复到相同地域且同仓库下的其他SAP HANA实例的操作步骤与同实例恢复类似，区别仅在于您需要选择不同于待恢复的SAP HANA实例作为源实例进行恢复。

![instance2](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1559029951/p96460.jpg)

此外，选择跨实例恢复时，需要在确认源实例和目的实例信息无误后，填写**源系统名**。源系统名表示需要恢复的源数据库名，格式为`源数据库名@SID`。

![systemname](https://static-aliyun-doc.oss-accelerate.aliyuncs.com/assets/img/zh-CN/1559029951/p96469.jpg)

**说明：** 跨实例恢复的其他步骤，请参见[同地域下的同实例恢复](#section_ddv_n6h_rx6)。

## 跨地域下的跨实例恢复

备份库是混合云备份的云上存储仓库，用于保存备份的数据。您可以根据备份容灾的需要，使用异地镜像备份库实现跨地域恢复SAP HANA数据库。

使用异地镜像备份库实现跨地域恢复SAP HANA数据库前，您需要有已创建的镜像备份库。有关创建镜像备份库的详情，请参见[使用镜像备份库实现跨地域备份](/cn.zh-CN/跨地域异地备份/使用镜像备份库实现跨地域备份.md)。

将备份的数据库恢复到其他地域下的SAP HANA实例的操作步骤如下：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。

2.  在左侧导航栏，单击**备份** \> **ECS应用备份** \> **SAP HANA**。

3.  选择镜像备份库所在的地域。

4.  在**SAP HANA实例**页签，为指定的SAP HANA实例安装备份客户端。

    **说明：** 备份库需选择已创建的镜像备份库，且镜像备份库名称带\[COPY\]字样。其他安装备份客户端参数配置，请参见[注册SAP HANA实例](/cn.zh-CN/ECS备份教程/SAP HANA备份/配置SAP HANA备份/注册SAP HANA实例.md)。

5.  找到需要恢复的SAP HANA实例，在其右侧的操作列表中，单击**恢复**。

    其他操作步骤与[同地域下的跨实例恢复](#section_5ox_k3g_4am)类似。


## 更多操作

您可以查看恢复任务的状态，或取消正在执行的恢复任务。具体操作如下：

1.  在左侧导航栏，选择**备份****ECS应用备份** \> **SAP HANA**。

2.  单击**恢复任务**页签。

3.  在恢复任务列表中查看恢复任务的状态。

4.  如需取消正在进行中的恢复任务，在恢复任务右侧，单击**取消**。


