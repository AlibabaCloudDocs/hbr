# 备份SQL Server

您可以使用混合云备份服务（HBR）来备份ECS实例中部署的SQL Server数据库，并在需要时恢复。本文介绍如何备份SQL Server的数据库。

## 前提条件

您已经完成了[准备工作](/cn.zh-CN/ECS备份教程/SQL Server备份/准备工作.md)。

## 背景信息

备份SQL Server数据库时，请注意以下事项：

-   确保已安装.NET Framework 4.5及以上版本。
-   混合云备份服务支持备份的SQL Server版本包括SQL Server 2008R2、SQL Server 2012、SQL Server 2014、SQL Server 2016、SQL Server 2017。具体请参见[使用限制](/cn.zh-CN/产品简介/使用限制.md)。
-   SQL Server数据库不支持数据库文件位于启用了压缩功能的文件系统上，更多数据库安装限制请参见[SQL Server的默认实例和命名实例的文件位置](https://docs.microsoft.com/en-us/sql/sql-server/install/file-locations-for-default-and-named-instances-of-sql-server?view=sql-server-2017)。

## 创建备份计划

请按如下步骤创建备份计划：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。

2.  在左侧导航栏，单击**备份** \> **ECS应用备份** \> **SQL Server**。

3.  找到目标SQL Server实例，在其右侧的操作列表，单击**备份**。

4.  在弹出的**新建备份计划**页面，选择需要备份的数据库。

    -   如果已创建需要备份的数据库组，单击**选择数据库组**，然后选择一个数据库组。
    -   如果您还没有完成[步骤3：创建备份数据库组](/cn.zh-CN/ECS备份教程/SQL Server备份/准备工作.md)，单击**选择数据库**，选择需要备份的数据库，输入组名，创建一个新的数据库分组。
    -   如果您需要备份所有数据库，单击**所有数据库**，选择**是否包含系统数据库**。
5.  单击**下一步**，然后按照以下说明进行配置：

    |参数|说明|
    |:-|:-|
    |备份类型|    -   **全量**：进行全量备份。
    -   **差量**：备份上次全量备份后的变动数据。

**说明：**

        -   第一次差量备份前，需先完成一次全量备份。
        -   数据库进行过恢复任务后，如需做差量备份，需先完成一次全量备份。
    -   **日志**：备份数据库的日志。

**说明：**

        -   第一次日志备份前，需先完成一次全量备份。
        -   数据库进行过恢复任务后，如需做日志备份，需先完成一次全量备份。 |
    |备份计划名称|输入备份计划的名称。|
    |备份起始时间|选择开始备份的时间。时间精确到秒。|
    |备份执行间隔|选择备份的频率。时间精确到小时。|
    |备份保留策略|选择**指定保留时间**或**永久**保留备份数据。 选择**指定保留时间**的备份保留策略时，备份保留时间最短为1天，最长为999年。

**说明：** 差量备份的保留时间与全量备份相同，且不可更改。 |

6.  单击**创建**。

    **说明：** 如果您需要修改备份保留时间，重复以上步骤，重新选择一个备份保留时间即可。


## 更多操作

创建备份计划完成后，您可以执行查看及管理备份计划、取消备份任务、及查看数据库及日志备份历史等操作。

-   查看及管理备份计划

    您可以查看备份计划信息和状态，并且管理备份计划。

    1.  在左侧导航栏，单击**备份** \> **ECS应用备份** \> **SQL Server**。
    2.  单击**备份计划**页签。
    3.  在备份计划列表中查看备份计划的信息及状态。
    4.  在操作列表中，您可以根据需要管理备份计划。您可以选择**编辑**备份计划、**立即执行**、**暂停计划**、**继续计划**和**删除计划**。删除备份计划后，该计划不会再执行，已完成的备份会为您保留。
-   查看或取消备份计划

    您可以查看备份任务状态，或取消一个进行中的备份任务。

    1.  在左侧导航栏，单击**备份** \> **ECS应用备份** \> **SQL Server**。
    2.  单击**备份任务**页签。
    3.  在备份任务列表中查看备份任务的信息及状态。
    4.  如果需要取消一个正在进行中的备份任务，在其右侧单击**取消**。
-   查看数据库及日志备份历史

    您可以查看所有数据库及日志的备份历史。

    1.  在左侧导航栏，选择**备份** \> **ECS应用备份** \> **SQL Server**。
    2.  单击**SQL Server实例**页签。
    3.  找到目标SQL Server实例，单击实例ID，或在实例右侧的操作列表，单击**更多** \> **查看详情**。

        ![id](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4827909951/p110898.jpg)

    4.  单击**数据备份历史**或**日志备份历史**页签，查看数据库备份记录以及日志备份记录。

