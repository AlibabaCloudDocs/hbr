# 准备工作 {#concept_qnt_cz5_fgb .concept}

您可以使用混合云备份服务（HBR）来备份ECS实例中的文件，并在需要时恢复。备份前您需要做以下准备工作。

**说明：** 

-   为达到最佳备份速度，使用混合云备份客户端时，建议运行备份客户端的机器使用双核及以上64位CPU，并配备8GB以上的可用内存。如果目录下的文件数目是千万级别以上的，建议配备16G的可用内存。
-   系统能够备份的数据规模取决于内存资源。在4GB可用系统内存的情况下可备份的最大文件数量为100万个，总数据量为8TB。
-   目前HBR仅支持华东1（杭州）、华东2（上海）、华北2（北京）、华南1（深圳）地域中的ECS文件备份。

## 授权角色 {#section_pts_5z5_fgb .section}

使用混合云备份服务来备份ECS文件时需要您同意授权创建两个角色：AliyunHBRDefaultRole，AliyunECSAccessingHBRRole。具体步骤如下：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。
2.  选择**ECS备份** \> **ECS文件备份**。
3.  页面会依次弹出授权对话框，根据提示授权这两个角色。

![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/82684/155980965637733_zh-CN.png)

## 云助手 {#section_qb5_wz5_fgb .section}

-   ECS备份客户端需要和阿里云云助手配合使用。2017年12月01日之后创建的ECS实例，默认预装了云助手客户端。如果需要备份的ECS实例是2017年12月01日之前购买的，需要您自行[安装云助手客户端](../../../../cn.zh-CN/部署与运维/云助手/配置云助手客户端.md)。
-   已经安装好云助手的经典网络ECS实例需要按照以下步骤配置云助手。
    -   Windows系统：
        1.  远程连接该ECS实例。然后在C:\\ProgramData\\aliyun\\assist\\目录下创建`region-id`文件，并根据ECS所在地域，在文件中写入相应的`region id`。例如，ECS实例的地域为杭州，则写入`cn-hangzhou`。

            ``` {#codeblock_5ry_xfx_xpr}
            echo cn-hangzhou >C:\ProgramData\aliyun\assist\region-id
            ```

            各地域相对应的region-id参见下表：

            |地域|region-id|
            |:-|:--------|
            |华东1（杭州）|cn-hangzhou|
            |华东2（上海）|cn-shanghai|
            |华北2（北京）|cn-beijing|
            |华南1（深圳）|cn-shenzhen|

        2.  在任务管理器重启AliyunService服务。
    -   Linux系统：
        1.  远程连接该ECS实例。在/usr/local/share/aliyun-assist/目录下创建`region-id`文件，并根据ECS所在地域，在文件中写入相应的`region id`。例如，ECS实例的地域为杭州，则写入`cn-hangzhou`。

            ``` {#codeblock_tec_648_m11}
            echo cn-hangzhou >/usr/local/share/aliyun-assist/region-id
            ```

            各地域相对应的region-id参见下表：

            |地域|region-id|
            |:-|:--------|
            |华东1（杭州）|cn-hangzhou|
            |华东2（上海）|cn-shanghai|
            |华北2（北京）|cn-beijing|
            |华南1（深圳）|cn-shenzhen|

        2.  依次运行`chkconfig agentwatch off`以及`chkconfig agentwatch on`或直接运行`systemctl restart agentwatch`重启云助手服务。

            **说明：** 如果重启后云助手仍无法运行，请使用以上命令再次重启云助手。


## 安装ECS备份客户端 {#section_vb1_zz5_fgb .section}

您可以使用ECS备份客户端备份和恢复ECS文件。安装客户端有以下两种方式：

-   **少量安装ECS备份客户端**：为少量ECS实例安装客户端。
-   **批量安装ECS备份客户端**：一次为多个ECS实例安装客户端。

 **少量安装ECS备份客户端** 

具体操作步骤如下：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。
2.  选择要备份的ECS实例所在的区域。
3.  在左侧导航栏，选择**ECS备份** \> **ECS文件备份**。
4.  在页面右上角，单击**添加ECS实例**。
5.  在添加ECS实例页面，配置**备份仓库名称**。在下拉框中选择您之前已经创建过备份仓库，如果您之前没有创建过备份仓库，单击**新建仓库**，然后输入**仓库名称**和**描述**即可创建一个新仓库。仓库名称不得超过64个字节。

    **说明：** 备份仓库是混合云备份的云上存储仓库，用于保存备份的数据。多个客户端可以备份到同一个仓库。备份仓库有地域属性，您仅能选择或者新建当前地域下的仓库。

6.  勾选需要安装客户端的ECS实例。您也可以在搜索栏左侧，选择实例ID、实例名、VPC ID、私有IP（VPC）以及内网IP（经典网络），然后输入相应的全称或关键字搜索目标实例。

    **说明：** 

    -   您只能勾选或搜索当前地域下的ECS实例。
    -   如果您选择了经典网络类型的实例，还需输入[AccessKey Id和AccessKey Secret](../../../../cn.zh-CN/常见问题/一般性问题/RAM用户如何获取AccessKey.md)。
7.  配置完成后，单击**创建**后系统会自动在您选择的ECS中安装备份客户端。

 **批量安装ECS备份客户端** 

具体操作步骤如下：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。
2.  选择要备份的ECS实例所在的区域。

    **说明：** 选择地域后，您只能批量为该地域下的ECS实例安装客户端。

3.  在左侧导航栏，选择**ECS备份** \> **ECS文件备份**。
4.  在页面右上角，选择**批量操作** \> **批量添加ECS实例**。
5.  在批量添加ECS实例页面，输入**备份仓库名称**来新建一个备份仓库，然后添加仓库描述。仓库名称不得超过64个字节。

    **说明：** 备份仓库有地域属性，您仅能新建当前地域下的仓库。

6.  （可选）指定需要安装客户端的ECS的私有IP（VPC）或内网IP（经典网络）。

    **说明：** 

    -   输入指定IP后，模版中只会显示指定IP相应的ECS实例。
    -   如果不指定IP，模版中会显示当前地域下的所有ECS实例。
    -   多个IP需用英文逗号（,）分隔开。
7.  单击**下载模板**。
8.  打开下载的模板文件，填写**Access Key ID**及**Access Key Secret**（VPC网络类型的实例无需填写），然后保存文件。

    **说明：** 

    -   模版里面只会显示已安装云助手且未安装备份客户端的ECS实例。
    -   如果批量创建超过20个客户端，系统会自动创建新的仓库以容纳额外的客户端。
    -   关于如何获取Access Key ID和Access Key Secret，参见[RAM用户如何获取AccessKey](../../../../cn.zh-CN/常见问题/一般性问题/RAM用户如何获取AccessKey.md)。
    -   如果您不需要在某个ECS上安装客户端，请删除该ECS所在一整行。
    -   请不要修改模板文件中的**Instance Id**、**Instance Name**、以及**Network Type**。
    -   为了您的账号安全，在成功上传模版之后，删除本地模版文件。
9.  单击**上传文件**，上传填写好的模板。

上传模板后，页面会显示已选择的各类型的ECS实例数量以及总数量。

## 管理实例客户端 {#section_hz5_kbv_fgb .section}

在ECS文件备份页面，单击**ECS实例**页签，找到目标ECS实例。如实例过多，您可以在页面右上角的搜索栏，输入目标ECS实例的私有IP（VPC）或内网IP（经典网络）搜索目标ECS实例。

找到目标ECS实例后，您可以：

|操作|描述|
|:-|:-|
|查看客户端的安装状态|安装成功后，客户端状态会显示为已激活。如状态为安装失败，请根据错误信息提示进行操作，然后在操作中选择**重新安装**。|
|卸载客户端|您可以在实例右侧，选择**更多** \> **卸载客户端**。|
|删除客户端|如需在ECS实例列表上删除一个ECS实例，并卸载在该ECS实例上安装的客户端，您可以在节点右侧，选择**更多** \> **删除**。 **说明：** 删除客户端前您需要确保该客户端上没有正在进行中或已完成的备份任务。

 |
|升级客户端|找到目标ECS实例，单击**升级**，将当前的客户端升级到最新版本。|

## 后续操作 {#section_irf_dlg_mgb .section}

[备份ECS文件](cn.zh-CN/ECS备份教程/文件备份/备份ECS文件.md)

