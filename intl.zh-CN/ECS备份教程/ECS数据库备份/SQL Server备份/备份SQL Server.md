# 备份SQL Server

您可以使用混合云备份服务（HBR）来备份ECS实例中部署的SQL Server数据库，并在需要时恢复。本文介绍如何备份SQL Server数据库。

## 注意事项

备份SQL Server数据库时，请注意以下事项：

-   确保已安装.NET Framework 4.5及以上版本。
-   混合云备份服务备份的SQL Server有版本限制。更多信息，请参见[概述](/intl.zh-CN/ECS备份教程/ECS数据库备份/概述.md)。
-   SQL Server数据库不支持数据库文件位于启用了压缩功能的文件系统上，更多数据库安装限制请参见[SQL Server的默认实例和命名实例的文件位置](https://docs.microsoft.com/en-us/sql/sql-server/install/file-locations-for-default-and-named-instances-of-sql-server?view=sql-server-2017)。
-   SQL Server数据库配置为简单模式（默认配置）时，不支持**日志备份**，请使用**全量备份**或**累计增量备份**。
-   SQL Server中master数据库只支持**全量备份**，不支持**累计增量备份**和**日志备份**。

## 创建备份计划

注册SQL Server实例后，您需要为实例创建备份计划，混合云备份服务（HBR）会按照备份计划进行数据库备份。具体操作如下：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。

2.  在左侧导航栏，选择**备份** \> **ECS数据库备份**。

3.  在ECS数据库备份页面，单击**SQL Server**。

4.  在页面上方，选择已备份数据库所在的区域。

5.  在数据库实例页签，找到目标SQL Server实例，在其右侧的操作列表，单击**备份**。

6.  在**新建备份计划**面板，配置如下信息。

    1.  配置备份内容。

        1.  输入**备份计划名称**。
        2.  选中需要备份的实例。
        3.  单击**下一步**。
    2.  配置备份计划。

        1.  选择备份策略。

            |参数|说明|
            |--|--|
            |全量备份|全量备份数据库文件，备份内容是操作系统上数据库文件。恢复时只能恢复到具体备份的时间点。

支持立即（备份一次）、指定时间（备份一次）、按小时（周期备份）、按天（周期备份）、按星期（周期备份）和按月（周期备份）。您可以按照需要制定备份计划。 |
            |累计增量备份|只备份增量部分数据库文件，备份内容是操作系统上数据库文件。恢复时只能恢复到具体备份的时间点。

支持立即（备份一次）、指定时间（备份一次）、按小时（周期备份）、按天（周期备份）、按星期（周期备份）和按月（周期备份）。您可以按照需要制定备份计划。 |
            |日志备份|数据库日志备份，恢复时可以灵活选择恢复的时间点。支持立即（备份一次）、指定时间（备份一次）、按小时（周期备份）、按天（周期备份）、按星期（周期备份）和按月（周期备份）。您可以按照需要制定备份计划。 |

        2.  单击**下一步**。
    3.  配置备份选项。单击**下一步**。

        支持配置并发数、断线重连时间和限制的速度。

    4.  选择备份库。

        **说明：** 目前一个实例只能备份到同一个备份库，不支持备份到多个备份库。

        -   如果已创建需要备份的备份库，单击**选择备份库**，从**备份库名称**列表中，选择已创建备份库。
        -   如果您需要新创建备份库，单击**新建备份库**，输入备份库名称，并按照页面提示配置其他参数。
7.  单击**确定**。


## 更多操作

创建备份计划完成后，您可以查看及管理备份计划、删除备份任务、查看数据库及日志备份历史等操作。

-   管理备份计划

    您可以查看备份计划信息和状态，并且管理备份计划。

    1.  在左侧导航栏，选择**备份** \> **ECS数据库备份**。
    2.  单击**SQL Server**。
    3.  单击**备份计划**页签。在备份计划列表中查看备份计划的信息及状态。
    4.  在操作列表中，您可以根据需要管理备份计划。您可以选择**编辑**、**立即执行**、**取消执行**和**删除**备份计划。删除备份计划后，该计划不会再执行，已完成的备份会为您保留。
-   报警设置

    您可以为备份计划设置报警。

    1.  在左侧导航栏，选择**备份** \> **ECS数据库备份**。
    2.  单击**SQL Server**。
    3.  单击**备份计划**页签。在备份计划列表中查看备份计划的信息及状态。
    4.  在操作列表中，选择**更多** \> **报警设置**。
    5.  选择备份报警方式，单击**确定**。

        支持如下报警方式。

        -   关闭：关闭报警功能。
        -   跟备份库报警一致：与备份库设置中报警方式一致。
        -   默认通知：与备份库设置中**默认通知**方式一致。
        -   自定义：自定义报警联系人，按照实际情况选择即可。
        设置报警联系人，请参见[设置报警联系人](/intl.zh-CN/本地服务器备份教程/文件备份/备份报警.md)。

-   查看数据库及日志备份历史

    您可以查看所有数据库及日志的备份历史。

    1.  在左侧导航栏，选择**备份** \> **ECS数据库备份**。
    2.  单击**SQL Server**。
    3.  单击**执行历史**页签。查看数据库备份记录以及日志备份记录。

