# 备份ECS文件

您可以使用混合云备份服务（HBR）备份ECS实例中的文件，并可以在文件丢失或受损时进行恢复。本文为您介绍如何备份ECS实例中的文件。

## 前提条件

您已经完成了[准备工作](/intl.zh-CN/ECS备份教程/ECS 文件备份/准备工作.md)。

## 为单个ECS实例备份文件

使用混合云备份服务为单个ECS实例进行文件备份的操作步骤如下：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。

2.  在左侧导航栏，选择**备份** \> **ECS文件备份**。

3.  在ECS文件备份页面，单击**ECS实例**页签。

4.  找到目标ECS实例，在其右侧的操作栏单击**备份**。

5.  在**创建备份计划**页面，按照以下说明配置参数，然后单击**创建**。

    ![](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/3248449951/p66010.jpg)

    |参数|说明|
    |:-|:-|
    |备份计划名称|为该备份计划命名。可不填，默认名字随机分配。|
    |备份文件路径|备份路径规则如下：     -   无通配符（\*）的情况下，可以输入8行路径。
    -   使用通配符（\*）时，只能输入1行路径，支持形如/\*/\*的通配符。
    -   每行只支持绝对路径，例如以（/, \\\\, C:\\, D:\\）开头。
 **说明：**

    -   不支持多个根路径同时备份，例如C:\\和D:\\不能同时备份。
    -   使用VSS时，不支持多个路径、UNC路径、通配符、排除文件。
    -   使用UNC时，不支持VSS、通配符、排除文件。当备份源包含UNC路径时，将不会对Windows ACL进行备份。 |
    |备份文件规则|您可以选择**包括所有文件**和**排除下列文件**。 选择**排除下列文件**后，需要输入文件列表。

**说明：** 排除路径包含如下规则：

    -   最多支持8条路径，包括使用通配符（\*）的路径。
    -   如果路径不含正斜线（/），则通配符（\*）匹配多层路径名或文件名，例如\*abc\*会匹配/abc/，/d/eabcd/，/a/abc；\*.txt将匹配所有.txt为扩展名的文件。
    -   如果路径包含正斜线（/），则每个通配符（\*）只匹配单层路径或文件名。例如/a/\*/\*/share会匹配/a/b/c/share，不会匹配/a/d/share。
    -   如果路径以正斜线（/）结束，则表示文件夹匹配，例如 \*tmp/ 会匹配 /a/b/aaatmp/，/tmp/ 等。
    -   路径分隔符以Linux系统的正斜线（/）为例，如果是Windows系统请换成反斜线（\\）。 |
    |备份起始时间|选择备份开始执行的时间。时间精确到秒。|
    |备份执行间隔|选择增量备份的频率。时间单位：时、天、周。 **说明：** 备份执行间隔最大可支持52周，即一年。 |
    |备份保留时间|选择保留该备份的时间。时间单位：天、周、月、年。|
    |是否使用VSS|    -   此功能仅Windows系统实例支持。
    -   如果备份源中有数据更改，需要确保备份数据与源数据的一致时，选择**使用**。
    -   选择使用VSS后，不支持多个文件目录同时备份。
 **说明：** 当备份源位于exFat格式的卷时不支持该功能。 |
    |是否使用流量控制|流量控制可以帮助您在业务高峰期，控制备份文件目录的流量，以免影响正常业务。

 如选择**使用**，您需要根据业务情况，选择限流时间段，输入限流时间段内备份可使用的最大流量，然后单击**添加**。 |


## 批量为多个ECS实例备份文件

如果您需要备份多个ECS实例，可以批量创建多个备份任务。具体操作如下：

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。

2.  在左侧导航栏，选择**备份** \> **ECS文件备份**。

3.  在页面上方选择需要备份的ECS实例所在的地域。

4.  在页面右上角，选择**批量操作** \> **批量创建备份计划**。

5.  在批量创建备份计划页面，单击**下载模板**。

6.  打开下载的模板文件，按照以下说明配置模板，然后保存文件。

    **说明：** 如果您不需要备份某个实例，请删除该实例所在行。

    |参数|说明|
    |:-|:-|
    |Client Id|表示当前可用于备份的客户端。请不要修改。|
    |Instance Id|客户端对应的ECS实例ID。请不要修改。|
    |Instance Name|客户端对应的ECS实例名。请不要修改。|
    |Source|输入需要备份的文件目录。路径必须为绝对路径。|
    |Plan Name|输入备份计划的名字。可不填，默认名字随机分配。|
    |Retention \(Day\)|    -   输入备份的时长，输入数值需为整数。
    -   单位默认为天。
    -   可不填，默认保存备份文件730天。 |
    |Effective Time|输入备份开始执行的时间。格式为`YYYY-MM-DD/HH:MM:SS`例如2018-12-03/12:00:00。|
    |Backup Interval|    -   输入进行增量备份的时间间隔，输入值需为整数。
    -   单位默认为小时。
    -   可不填，默认间隔为24小时。 |
    |Use VSS for backup|    -   此功能仅Windows系统实例支持。
    -   如果备份源中有数据更改，需要确保备份数据与源数据的一致，可使用此功能。
    -   如需使用输入Y，不使用输入N。可不填，默认不使用。
    -   选择使用VSS后，不支持多个文件目录同时备份。 |
    |Bandwidth Throttling|    -   流量控制。可以控制备份文件目录的所使用的流量，以免影响正常业务。
    -   如选择使用此功能，输入全时段备份可使用的最大流量。
    -   输入数值需为整数。单位默认为MB。
    -   可不填，默认不限流。 |

7.  单击**上传文件**，上传填写好的模板。

8.  单击**创建**。


## 在线浏览备份文件

您可以通过混合云备份的在线浏览功能快速浏览每个备份计划下的所有文件。

1.  在备份计划和任务页签，单击对应备份任务右侧的**查看**。

    ![](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4248449951/p66158.jpg)

2.  单击**浏览**。

    ![](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4248449951/p66161.jpg)

    在浏览页签，查看源目录下的所有文件。

    ![](https://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/zh-CN/4248449951/p66164.jpg)

    **说明：** 本页面只提供浏览功能，如需恢复ECS文件，请参见[恢复ECS文件](/intl.zh-CN/ECS备份教程/ECS 文件备份/恢复ECS文件.md)。


## 相关操作

在ECS文件备份页面，单击**备份计划和任务**页签，您可以进行如下相关操作。

|操作|步骤|
|:-|:-|
|查看错误报告|在备份计划任务右侧，查看备份进度。如部分文件备份失败，单击**查看**，在错误数量一栏，单击下载图标下载**错误报告**。|
|开始备份|在备份计划任务右侧的操作列表，选择**更多** \> **立即执行**。|
|取消执行中的备份任务|在备份计划任务右侧的操作列表，选择**更多** \> **取消执行**。|
|暂停执行中的备份任务|在备份计划任务右侧的操作列表，**更多** \> **暂停**。|
|继续执行已暂停的备份任务|在备份计划任务右侧的操作列表，选择**更多** \> **继续**。|
|修改备份计划|在备份计划任务右侧的操作列表，选择**更多** \> **编辑**。|
|删除备份计划|在备份计划任务右侧的操作列表，选择**更多** \> **删除**。备份计划删除后，该备份计划不会继续执行，但仍保留已备份的数据。|

## FAQ

当您文件备份因为网络不稳定等因素造成失败时，可以通过以下步骤配置相关参数进行失败后重试。

1.  登录需要备份文件的服务器。
2.  找到并打开混合云备份客户端的安装路径。
3.  在`client`文件夹的子目录下，创建文件`hbr.config`。

    **说明：** `hbr.config`的位置与`hybridebackup`以及`ids`可执行程序级别相同。

4.  在`hbr.config`文件中添加以下参数。

    |参数|说明|
    |--|--|
    |retry\_times|数据备份重试次数，默认3次。|
    |retry\_interval|数据备份重试间隔，默认100ms。|
    |skip\_error\_files|是否跳过备份失败文件。     -   false（默认值）：不跳过备份失败文件。
    -   true：跳过备份失败文件。 |


hbr.config文件的配置示例如下：

```
retry_times=3
retry_interval=100
skip_error_files=false
```

