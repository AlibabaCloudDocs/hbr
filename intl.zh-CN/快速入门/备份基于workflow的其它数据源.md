# 备份基于workflow的其它数据源 {#concept_dty_nds_5fb .concept}

本文介绍如何在无定期备份计划的情况下备份基于workflow的其它数据源。目前HBR支持备份SAP HANA、SQL Server、Oracle、MySQL、MongoDB、 Hyper-V等。

## 前提条件 {#section_z4n_bhk_5fb .section}

您已经在[混合云备份控制台](https://hbr.console.aliyun.com)开通了混合云备份服务。

您已经[开通了子账号](../../../../intl.zh-CN/最佳实践/用户权限管理.md)，并保存好子账号AK。

**说明：** 激活备份客户端需要AK信息，由于主账号AK泄露会威胁您所有资源的安全，强烈建议您使用子账号AK进行操作。

## 步骤一 创建仓库 {#section_vnh_dvd_qfb .section}

备份仓库是混合云备份的云上存储仓库，用于保存备份数据。具体操作步骤如下：

1.  在需要备份文件的服务器或虚拟机上登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。

    **说明：** 若服务器或虚拟机使用的是未安装图形化界面的Linux系统，需要在有图形化界面的机器（中转机）上登录阿里云混合云备份管理控制台。

2.  在概览页面，根据需要选择备份仓库的地域。

    -   如要使用专有网络，仓库地域和备份源所在的专有网络地域必须一致。
    -   如考虑备份性能，请选择离备份源近的地域。
    -   如考虑容灾场景，请选择离备份源远的地域。
    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/40337/154417026021115_zh-CN.png)

3.  在页面右上角，单击**新建仓库**。
4.  在新建仓库页面，输入仓库名称、仓库描述，选择是否开启[备份搜索](../../../../intl.zh-CN/用户指南/文件备份/备份搜索.md)，然后单击**创建**。

    **说明：** 

    -   仓库名称不得超过32个字节。
    -   目前仅华东1（杭州）和华东2（上海）地域支持备份搜索功能。

## 步骤二 添加客户端 {#section_hkk_sds_5fb .section}

添加客户端并将客户端下载到需要备份的服务器或虚拟机上。客户端可以帮助您进行备份和恢复任务。具体操作步骤如下：

1.  在左侧导航栏，选择**备份类型** \> **文件客户端**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/40337/154417026021116_zh-CN.png)

2.  在页面右上角，单击**添加客户端**。
3.  在添加客户端页面，配置参数，然后单击**创建**。各参数说明如下。

    |参数|说明|
    |:-|:-|
    |仓库设置|选择备份仓库。     -   如想选择一个已创建好的仓库，单击**选择仓库**。
    -   如想新建一个仓库，单击**新建仓库**。
 |
    |仓库名称|选择或者重新输入一个新的仓库名称。|
    |客户端名称|为此客户端命名。仓库名称不得超过32个字节。|
    |软件平台|选择备份源使用的系统。混合云备份支持以下四种平台：     -   Window 32-bit
    -   Window 64-bit
    -   Linux 32-bit
    -   Linux 64-bit
 |
    |网络类型|     -   专有网络：备份源使用阿里云专有网络（VPC），且和备份仓库在同一个地域时选择此项。
    -   经典网络：无法使用专有网络的场景下选择此项。
 |
    |报警通知|开启后，如果计划备份失败或客户端与服务器连接断开，系统会向您设置的报警联系人发邮件通知。|

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/40337/154417026021117_zh-CN.png)

4.  单击**下载客户端**和**下载证书**。

    客户端安装包用于连接阿里云备份服务，证书用来激活该客户端。您也可以返回客户端列表，在任意时间选择下载。


## 步骤三 安装客户端 {#section_olr_22s_5fb .section}

将客户端和证书下载到需要备份的服务器或虚拟机上后，需要安装部署该客户端。具体操作步骤如下：

1.  安装下载的客户端安装包，选择可用的安装目录。运行的日志和执行文件都会在该目录下，确保该目录下有可用的空间。
    -   如果是Windows系统，运行安装包，选择安装的目录， 根据提示完成整个安装。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/40337/154417026021118_zh-CN.png)

    -   如果是Linux系统，直接解压到特定目录，运行`./setup`开启混合云备份服务。

        ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/40337/154417026021119_zh-CN.png)

2.  登录浏览器，输入`http://localhost:8011`，进入初始化注册界面。

    **说明：** 如果是通过中转机来进行备份操作，需要把`localhost`换成需要备份的服务器或虚拟机的IP地址。

3.  上传Token并输入所需参数，然后单击**注册**。各参数说明如下：

    |参数|说明|
    |:-|:-|
    |上传Token|选择在控制台下载的证书作为上传的Token。每个证书的使用周期为2天，超过此周期，需要下载新的证书来注册客户端。|
    |Access Key ID和Access Key Secret|在开通HBR服务的阿里云账户中下载Access Key ID和Access Key Secret。详情参见[AccessKey](../../../../intl.zh-CN/常见问题/RAM用户如何获取AccessKey.md)。|
    |网络类型|     -   专有网络：备份源使用阿里云专有网络（VPC），且和备份仓库在同一个地域时选择此项。
    -   经典网络：无法使用专有网络的场景下选择此项。
 |
    |登录密码|设置此客户端登录密码，登录密码至少为6位。|
    |用登录密码加密AK|如果使用登录密码来加密，每次重启动后都需要手动输入。|

    **说明：** 注册完成后，即可以开始备份。


## 步骤四 备份 {#section_tys_p3x_5fb .section}

混合云备份有两种备份模式：立即备份，计划备份。本文主要介绍立即备份。立即备份指只进行全量备份。

1.  找到并打开混合云备份客户端的安装路径。在`client`的子目录下，创建文件`workflow.env` 。`workflow.env`的位置与`hybridebackup`及`ids`可执行程序级别相同。
2.  在`workflow.env`文件中输入备份源的用户名和密码。格式如以下示例。

    ```
    	USERNAME=root
    	PASSWORD=****
    ```

3.  [下载备份源相应的备份前脚本](../../../../intl.zh-CN/HBR 隐藏/数据库备份脚本.md)，并保存。
4.  打开并配置下载的脚本，然后保存配置好的脚本。具体配置参见[备份前脚本配置说明](../../../../intl.zh-CN/HBR 隐藏/备份前脚本配置说明.md)。
5.  打开混合云备份客户端，在页面右上角，单击下拉菜单，选择**创建备份工作流**。
6.  单击**创建备份工作流**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64013/154417026032244_zh-CN.png)

7.  在备份任务列表/创建备份工作流页面，单击**备份前脚本**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64013/154417026032245_zh-CN.png)

8.  在备份前脚本窗口，输入配置好的脚本文件路径。

    **说明：** 脚本路径最多为250个字符。

9.  单击**预览**核验脚本内容，然后单击**确定**。
10. 在备份任务列表/创建备份工作流页面，单击**备份计划**。

    ![](http://static-aliyun-doc.oss-cn-hangzhou.aliyuncs.com/assets/img/64013/154417026032246_zh-CN.png)

11. 在弹出的窗口中，选择**立即备份**。单击**确定**。
12. 在备份任务列表/创建备份工作流页面，单击**备份数据源**。
13. 在备份数据源窗口按照以下说明进行配置。然后单击**确定**。

    |参数|说明|
    |:-|:-|
    |源地址|     -   输入备份源的路径，最多可以输入8个路径，即最多支持8个文件目录同时备份。
    -   该路径为workflow备份专用，您需要选择一个空文件夹。
    -   支持UNC路径。
    -   每个路径使用回车分隔。
 |
    |使用VSS（Volume Shadow\(Copy\)Service，仅限Windows系统）|     -   如果备份源中有数据更改，需要确保备份数据与源数据的一致，勾选此项。
    -   此功能仅在Windows系统中支持。
    -   勾选此项后，不支持多个备份源同时备份。
 |

14. [下载相应的备份后脚本](../../../../intl.zh-CN/HBR 隐藏/数据库备份脚本.md)，将脚本中的路径配置成备份源的本地备份路径。保存脚本。
15. 在备份任务列表/创建备份工作流页面，单击**备份后脚本**。在备份后脚本窗口，输入上一步中配置好的脚本文件路径。单击**确定**。

    **说明：** 脚本路径最多为250个字符。

16. 在备份任务列表/创建备份工作流页面，单击**提交**开始备份。

