# 备份本地NAS

本文介绍如何使用混合云备份服务（HBR）备份本地NAS实例中的文件。

## 前提条件

已完成[准备工作](/intl.zh-CN/NAS备份教程/本地NAS备份/准备工作.md)。

## 新建备份计划

当您首次创建备份计划时，建议通过本地NAS备份向导进行完整的备份流程。支持NAS类型包括**Isilon \(PowerScale\)**和**其它**。本文以创建Isilon \(PowerScale\)类型NAS备份为例进行介绍。

1.  登录[混合云备份管理控制台](https://hbr.console.aliyun.com)。

2.  在左侧导航栏，选择**备份** \> **NAS备份** \> **本地NAS**。

3.  单击右上角的**NAS备份向导**。

    1.  添加NAS实例。

        1.  在创建备份计划的备份源页签，备份NAS实例选择**添加NAS**。

            您也可以选择已有的NAS实例。

        2.  配置基础设置中重要参数描述如下。

            |参数|描述|
            |--|--|
            |**NAS类型**|实例名称。|
            |**NAS管理用户名**|管理用户名。|
            |**NAS管理密码**|管理密码。|
            |**NAS网络地址**|网络地址。|
            |**NAS管理端口**|管理端口。|
            |**NAS共享目录**|相对/ifs的路径，例如/myshare。仅支持中文、英文大小写，数字以及特殊符号`,-_=/.:\`。 |
            |**协议类型**|支持NFS和SMB。例如选择NFS。|

        3.  （可选）单击**显示高级设置**，然后单击**+配置挂载参数**。

            挂载文件系统时，可选择多种挂载参数，挂载参数之间使用英文逗号（,）分隔。各挂载参数说明如下表所示。

            |参数|描述|
            |:-|:-|
            |vers|文件系统版本。             -   vers=3：使用NFS v3协议挂载文件系统。
            -   vers=4：使用NFS v4协议挂载文件系统。 |
            |nolock|是否启用文件锁。|
            |proto|文件系统挂载协议。|
            |rsize|定义数据块的大小，用于客户端与文件系统之间读取数据。建议值：1048576 |
            |wsize|定义数据块的大小，用于客户端与文件系统之间写入数据。建议值：1048576 |
            |hard|在文件存储NAS暂时不可用的情况下，使用文件系统上某个文件的本地应用程序时会停止并等待至该文件系统恢复在线状态。建议启用该参数。|
            |timeo|指定时长，单位为0.1秒，即NFS客户端在重试向文件系统发送请求之前等待响应的时间。建议值：600（60秒） |
            |retrans|NFS客户端重试请求的次数。建议值：2 |

        4.  单击**下一步**。
    2.  新建客户端组。

        备份客户端组可以添加多个客户端，用于并发执行一个备份任务。

        1.  备份客户端组选择**新建客户端组**，然后自定义**客户端组名称**，并选中添加到客户端组的客户端。

            添加完成后，您还可以根据需要，在NAS实例页签右侧的操作栏，单击**更多** \> **调整客户端组**，修改或删除此客户端组包含的客户端。

            如果您还未安装客户端，请参见[下载并激活Linux客户端](/intl.zh-CN/NAS备份教程/本地NAS备份/准备工作.mdsection_73j_f0l_dct)。

        2.  单击**下一步**。
    3.  新建备份计划。

        1.  按以下说明填写基础设置中涉及的各项参数。

            |参数|说明|
            |--|--|
            |备份库配置|您可以**选择备份库**。如果您之前没有创建过备份仓库，单击**新建备份库**，然后输入备份库名称即可创建一个新备份库。备份库名称不得超过64个字节。 **说明：** 备份库是混合云备份的云上存储仓库，用于保存备份的数据。多个客户端可以备份到同一个仓库。备份库有地域属性，您仅能选择或者新建当前地域下的备份库。 |
            |备份计划名称|为该备份计划命名。可不填，默认名字随机分配。|
            |备份文件路径|输入要备份的文件目录。只支持指定一个文件目录，且不支持通配符。|
            |备份文件规则|备份文件规则包含以下三种：            -   **包含所有文件**：选择此项后，将备份所选备份路径下的所有文件。
            -   **包含下列文件**或**排除下列文件**：选择任意选项后，在输入文件列表框中手动填写文件列表，将按照规则备份所选备份路径下指定的文件。

文件列表相当于备份路径的一个子路径，子路径的匹配规则如下：

                -   如果子路径前缀为正斜线（/），将在备份路径下按照全路径匹配过滤。

例如备份文件路径为/ifs/dataset，文件列表填写为/subdir/data，则备份（或不备份）/ifs/dataset/subdir/data路径下的文件和目录。

例如备份文件路径为/ifs/dataset，文件列表填写为/abc\*，则备份（或不备份）/ifs/dataset/abc路径下匹配前缀abc的文件或目录。

                -   如果子路径前缀不为正斜线（/），将在备份路径下面按照相对路径匹配过滤， 即备份路径下任意子路径匹配规则都会命中。

例如备份文件路径为/ifs/dataset，文件列表填写为abc\*，则备份（或不备份）/ifs/dataset路径下匹配前缀abc的文件或目录。

例如备份文件路径为/ifs/dataset，文件列表填写为abc，则备份（或不备份）/ifs/dataset路径下所有名为abc的文件或目录。 |
            |备份起始时间|选择备份开始执行的时间。时间精确到秒。|
            |备份执行间隔|选择增量备份的频率。时间单位：小时、天、周。|
            |备份保留策略|选择保留该备份的时间。            -   **指定保留时间**：保留时间单位为天、周、月、年。
            -   **永久**：选择此项后，将永久保留备份数据。 |

        2.  （可选）单击**显示高级设置**，并按以下说明填写各项参数。

            |参数|说明|
            |--|--|
            |增量失败时转全量|开启该选项后，增量备份失败时将自动转为全量备份。增量备份失败的可能原因如下：            -   包含文件或排除文件的过滤规则被修改。
            -   上一次备份到备份仓库中的数据已过期。
            -   上一次备份时为Isilon创建的快照被删除。 |
            |文件分页切片大小|备份客户端组允许添加多个客户端并发执行一个备份作业，设置文件分页切片大小会将不少于该指定数量的文件分配给某一个客户端进行备份。|

        3.  单击**确定**。

            备份计划创建完成后，您可以在备份任务页签，查看备份任务进度。

        如果在首次备份任务完成后，需要创建更多的备份计划，建议通过NAS实例页签，单击目标NAS实例右侧的**新建备份计划**，并按照上述新建备份计划步骤说明完成相关参数配置。


